/*
JSONext library. Copyright (C) techspider 2019.
Licensed under GNU GPLv3.
*/
"use strict";function _defineProperty(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function _instanceof(e,r){return null!=r&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](e):e instanceof r}!function(){var e=["date","symbol","escape","regexp"],r=["\n","\r"," "],n=JSON,t=_defineProperty({defineVT:function(r,n){if(null==r||null==n)throw new Error("Invalid arguments provided.");if("string"!=typeof r)throw new Error("Type for argument 'type' must be a String.");if(!e.includes(r.toLowerCase()))throw new Error('The transformation "'.concat(r,'" is not a valid transformation.'));return"@T(".concat(r,", [").concat(n,"])")},resolveFromTStr:function(e){if(null==e)throw new Error("Invalid arguments provided.");if("string"!=typeof e)throw new Error("Type for argument 't_string' must be a String.");if(!e.startsWith("(")&&!e.endsWith(")"))throw new SyntaxError("Invalid transformation string provided.");var r=e,n=void 0,t=(r=r.substring(3,r.length-1)).substr(0,r.indexOf(",")).toLowerCase(),i=r.substring(r.indexOf("[")+1,r.lastIndexOf("]"));switch(t){default:throw new Error('Transformation "'.concat(t,'" is not supported.'));case"date":n=new Date(i);break;case"regexp":n=new RegExp(i);break;case"escape":n=i;break;case"symbol":switch(i.toLowerCase()){default:throw new Error('"'.concat(i,'" is not a recognized symbol specifier.'));case"nan":n=NaN;break;case"infinity":n=1/0}}return n},stringify:function(e,r,i){if(null==e)throw new Error("Invalid arguments provided.");return null!=r&&"function"!=typeof r?n.stringify(e,r,i):n.stringify(e,function(e,n){var i=e,o=n;return Number.isNaN(o)?o=t.defineVT("Symbol","NaN"):_instanceof(o,Date)?o=t.defineVT("Date",o.toUTCString()):_instanceof(o,RegExp)?o=t.defineVT("RegExp",o.source):"string"==typeof o&&o.startsWith("@T")?o=t.defineVT("Escape",o):o==1/0&&(o=t.defineVT("Symbol","Infinity")),null==r?o:r(i,o)},i)},compress:function(e){if(null==e)throw new Error("Invalid arguments provided.");if("string"!=typeof type)throw new Error("Type for argument 'text' must be a String.");for(var n="",t=this.process(e),i=!1,o=0,s=0;s<t.length;s++)if(i)i=!1;else if(0!=o||!r.includes(t[s]))if(n+=t[s],'"'!=t[s]);else{if(1==o&&!i){o=0;continue}o=1}return n},process:function(e){if(null==e)throw new Error("Invalid arguments provided.");for(var r=e,n=0,t=!1,i=0;i<r.length;i++)if("\\"!=r[i])if('"'!=r[i]||1==n)if('"'!=r[i]||1!=n){if(t)t=!1;else if(i+1<r.length){if(0!=n)continue;if("/"==r[i]&&"/"==r[i+1]){var o=r.indexOf("\n",i);-1==o&&(o=r.length);var s=r.substring(0,i),a=r.substring(o,r.length);r=s+a}else if("/"==r[i]&&"*"==r[i+1]){var f=r.indexOf("*/",i);if(-1==f)throw new SyntaxError("Failed to parse JSONext, missing matching */ for multi line comment at char "+(i+1));s=r.substring(0,i),a=r.substring(f+2,r.length);r=s+a,i-=1}}}else{if(t)continue;n=0}else n=1;else{if(t){t=!1;continue}t=!0}return r},parse:function(e,r){if(null==e)throw new Error("Invalid arguments provided.");return n.parse(this.process(e),function(e,n){var i=e,o=n;if("string"==typeof o&&o.startsWith("@T")){var s=o.trim();if(!s.startsWith("(")&&!s.endsWith(")"))throw new SyntaxError('Incomplete transformation specifier for property "'+i+'"');var a;void 0!==(a=t.resolveFromTStr(s))&&(o=a)}return null==r?o:r(i,o)})}},Symbol.toStringTag,"JSONext");"undefined"!=typeof window?window.JSONext=t:module.exports=t}();